(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e1aca58c"],{"0ed6":function(e,t,a){var r=a("f379");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var i=a("2fb2").default;i("f03e2a06",r,!0,{})},"163b":function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));a("7f7f"),a("ac6a");var r=a("2b0e"),i=function(e){return r["default"]._.mapValues(e,(function(e){return e||void 0}))}},"2cd0":function(e,t,a){t=e.exports=a("2350")(!1),t.push([e.i,"",""])},7385:function(e,t,a){"use strict";a.r(t);var r=a("b775");function i(e){return Object(r["a"])({url:"/host",method:"get",params:e})}function o(e){return Object(r["a"])({url:"/host/store",method:"post",data:e})}function n(e){return Object(r["a"])({url:"/host/remove/".concat(e),method:"post"})}function s(e){return Object(r["a"])({url:"host/ping/".concat(e),method:"get"})}var l=a("163b"),c=(a("7f7f"),{name:"AddHost",props:{open:{type:Boolean,default:!1,required:!0},type:{required:!0,default:"add",type:String},formData:{required:!0,default:function(){},type:Object}},data:function(){return{title:"新增",form:{id:"",name:"",port:5921,alias:"",remark:""},formRules:{name:[{required:!0,message:"请输入主机名",trigger:"blur"}],port:[{required:!0,message:"请输入端口",trigger:"blur"},{type:"number",message:"端口无效"}],alias:[{required:!0,message:"请输入节点名称",trigger:"blur"}]}}},created:function(){},mounted:function(){},methods:{submit:function(){var e=this;this.$refs["form"].validate((function(t){t&&o(e.form).then((function(){e.$emit("reload"),e.onClose()}))}))},onClose:function(){this.form={id:"",name:"",port:5921,alias:"",remark:""},this.$refs["form"].resetFields(),this.$emit("update:open",!1)}},filters:{},watch:{open:function(e){e&&"edit"===this.type&&(this.title="编辑",this.form.id=this.formData.id,this.form.name=this.formData.name,this.form.port=this.formData.port,this.form.alias=this.formData.alias,this.form.remark=this.formData.remark)}}}),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{directives:[{name:"drag-move",rawName:"v-drag-move"}],staticClass:"task-log",attrs:{title:e.title+"任务节点",visible:e.open,"before-close":e.onClose,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"600px"}},[[a("el-form",{ref:"form",attrs:{model:e.form,size:"mini",rules:e.formRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"节点名称",prop:"alias"}},[a("el-input",{model:{value:e.form.alias,callback:function(t){e.$set(e.form,"alias",t)},expression:"form.alias"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"主机名",prop:"name"}},[a("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"端口",prop:"port"}},[a("el-input",{model:{value:e.form.port,callback:function(t){e.$set(e.form,"port",e._n(t))},expression:"form.port"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{type:"textarea",rows:5,size:"medium",width:"100"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1)],e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.onClose}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确 定")])],1)],2)},m=[],d=a("2455");function f(e){a("0ed6")}var p=!1,h=f,v="data-v-1e4f653a",b=null,g=Object(d["a"])(c,u,m,p,h,v,b),y=g.exports,_={name:"HostList",components:{addHost:y},data:function(){return{newDate:(new Date).getTime(),listData:[],listLoading:!1,isAdmin:JSON.parse(localStorage.getItem("userInfo")).is_admin,hosts:[],total:0,listQuery:{page_size:20,page:1,id:"",name:"",alias:""},addHostOptions:{open:!1,type:"add",formData:{}}}},created:function(){this.renderList()},mounted:function(){},methods:{toTasks:function(e){this.$router.push("/task/manager/timing-tasks?host_id=".concat(e))},testLink:function(e){var t=this;s(e).then((function(e){t.$message.success(e.message)}))},removeHost:function(e){var t=this;this.$confirm("确认要删除任务节点吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){n(e.id).then((function(){t.renderList()}))})).catch((function(){}))},openHostDialog:function(e,t){this.addHostOptions={open:!0,type:e,formData:t}},renderList:function(){var e=this;this.listLoading=!0;var t=Object(l["a"])(this.listQuery);i(t).then((function(t){var a=t.data.data;e.total=t.data.total;var r=e._.cloneDeep(a);e.listData=[],e.listData=r,document.querySelector(".el-table__body-wrapper").scrollTop=0,e.listLoading=!1,e.$refs["table"].doLayout()})).catch((function(){e.listLoading=!1}))},handleFilter:function(){this.newDate=(new Date).getTime(),this.listQuery.page=1,this.renderList()},handleSizeChange:function(e){this.listQuery.page=1,this.listQuery.page_size=e,this.renderList()},handleCurrentChange:function(e){this.listQuery.page=e,this.renderList()},clearSearch:function(){this.$refs.listQuery.resetFields(),this.newDate=(new Date).getTime(),this.renderList()}},filters:{},watch:{}},k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"header-box"},[a("el-form",{ref:"listQuery",staticClass:"advt-form-inline",attrs:{inline:!0,model:e.listQuery,size:"mini"}},[a("el-form-item",{attrs:{label:"节点ID",prop:"id"}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入节点ID"},model:{value:e.listQuery.id,callback:function(t){e.$set(e.listQuery,"id","string"===typeof t?t.trim():t)},expression:"listQuery.id"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"主机名",prop:"name"}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入主机名"},model:{value:e.listQuery.name,callback:function(t){e.$set(e.listQuery,"name","string"===typeof t?t.trim():t)},expression:"listQuery.name"}})],1),e._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"debounce",rawName:"v-debounce:listQuery",value:e.handleFilter,expression:"handleFilter",arg:"listQuery"}],attrs:{"data-type":"search",type:"primary"}},[e._v("搜索")]),e._v(" "),a("el-button",{directives:[{name:"debounce",rawName:"v-debounce:listQuery",value:e.clearSearch,expression:"clearSearch",arg:"listQuery"}],attrs:{"data-type":"clear"}},[e._v("清空")])],1)],1),e._v(" "),a("el-row",{staticClass:"right-row"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.openHostDialog("add",{})}}},[e._v("新增")])],1)],1),e._v(" "),a("div",{staticClass:"content-box"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading.lock",value:e.listLoading,expression:"listLoading",modifiers:{lock:!0}}],key:e.newDate,ref:"table",staticStyle:{width:"100%"},attrs:{data:e.listData,"element-loading-text":"努力加载中",border:""}},[a("el-table-column",{attrs:{prop:"id",width:"100",label:"节点ID"}}),e._v(" "),a("el-table-column",{attrs:{prop:"alias",label:"节点名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"主机名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"port",width:"100",label:"端口"}}),e._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"备注"}}),e._v(" "),e.isAdmin?a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.openHostDialog("edit",t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){return e.toTasks(t.row.id)}}},[e._v("查看任务")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(a){return e.testLink(t.row.id)}}},[e._v("测试连接")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.removeHost(t.row)}}},[e._v("删除")])]}}],null,!1,3741859649)}):e._e()],1),e._v(" "),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper",small:"","current-page":e.listQuery.page,"page-sizes":[20,50,100,200],"page-size":e.listQuery.page_size,total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),a("add-host",e._b({on:{reload:e.renderList}},"add-host",e.addHostOptions,!1,!0))],1)},w=[];function D(e){a("b9e5")}var x=!1,Q=D,L="data-v-ea3a64b4",z=null,C=Object(d["a"])(_,k,w,x,Q,L,z);t["default"]=C.exports},b9e5:function(e,t,a){var r=a("2cd0");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var i=a("2fb2").default;i("6c793095",r,!0,{})},f379:function(e,t,a){t=e.exports=a("2350")(!1),t.push([e.i,"",""])}}]);