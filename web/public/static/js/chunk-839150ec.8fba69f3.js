(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-839150ec"],{"046e":function(t,e,a){var n=a("421d");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var r=a("2fb2").default;r("63a68292",n,!0,{})},"0c4d":function(t,e,a){"use strict";a.r(e);var n=a("163b"),r=a("b199"),o={name:"TaskLogDetail",props:{open:{required:!0,type:Boolean},detail:{required:!0,type:Object,default:function(){}}},data:function(){return{}},created:function(){},mounted:function(){},methods:{onClose:function(){this.$emit("update:open",!1)}},filters:{},watch:{}},s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"drag-move",rawName:"v-drag-move"}],attrs:{title:"任务执行结果",visible:t.open,"before-close":t.onClose,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"740px"}},[a("div",{staticStyle:{"margin-bottom":"15px",background:"#606266",color:"#fff",padding:"10px"}},[a("pre",[t._v(t._s(t.detail.command))])]),t._v(" "),a("div",{staticStyle:{background:"#606266",color:"#fff",padding:"10px"}},[a("pre",[t._v(t._s(t.detail.result))])])])},i=[],l=a("2455");function u(t){a("b46a")}var c=!1,d=u,f="data-v-d7896a26",p=null,m=Object(l["a"])(o,s,i,c,d,f,p),h=m.exports,b={name:"TaskLogs",components:{taskLogDetail:h},data:function(){return{expand:!1,newDate:(new Date).getTime(),listData:[],listLoading:!1,tableLoading:!0,logs:[],logTotal:0,listQuery:{page_size:20,page:1,task_id:"",protocol:"",status:""},isAdmin:JSON.parse(localStorage.getItem("userInfo")).is_admin,dialogVisible:!1,currentTaskResult:{command:"",result:""},protocolList:[{value:"1",label:"http"},{value:"2",label:"shell"}],statusList:[{value:"1",label:"失败"},{value:"2",label:"执行中"},{value:"3",label:"成功"},{value:"4",label:"取消"}],total:0,logsDetailOption:{open:!1,detail:{}}}},created:function(){this.renderList()},mounted:function(){},methods:{handleStopTask:function(t){var e=this;Object(r["k"])({id:t.id,task_id:t.task_id}).then((function(){e.renderList()}))},handleExpand:function(t){"expand"===t.type&&(this.expand=!this.expand,this.newDate=(new Date).getTime())},showTaskResult:function(t){this.logsDetailOption={open:!0,detail:t}},renderList:function(t){var e=this;t&&(this.listQuery.page=1),this.listLoading=!0;var a=Object(n["a"])(this.listQuery);Object(r["g"])(a).then((function(t){var a=t.data.data;e.total=t.data.total;var n=e._.cloneDeep(a);e.listData=[],e.listData=n,document.querySelector(".el-table__body-wrapper").scrollTop=0,e.listLoading=!1,e.$refs["table"].doLayout()})).catch((function(){e.listLoading=!1}))},clearLogs:function(){var t=this;Object(r["a"])().then((function(){t.listQuery.page=1,t.renderList()}))},formatProtocol:function(t,e){return 1===t[e.property]?"http":"shell"},handleFilter:function(){this.listQuery.page=1,this.renderList("search")},handleSizeChange:function(t){this.listQuery.page=1,this.listQuery.page_size=t,this.renderList()},handleCurrentChange:function(t){this.listQuery.page=t,this.renderList()},clearSearch:function(){this.$refs.listQuery.resetFields(),this.listQuery.task_id=void 0,this.renderList()}},filters:{formatTime:function(t){var e=function(t){return t>=10?t:"0"+t},a=new Date(t),n=a.getFullYear()+"-"+e(a.getMonth()+1)+"-"+e(a.getDate())+" "+e(a.getHours())+":"+e(a.getMinutes())+":"+e(a.getSeconds());return 0!==n.indexOf("20")?"":n}},watch:{expand:{immediate:!0,handler:function(t){this.$nextTick((function(){document.querySelector(".el-table th>.cell > svg")&&(document.querySelector(".el-table th>.cell > svg").style.transform=t?"rotate(90deg)":"rotate(0deg)")}))}},$route:{deep:!0,immediate:!0,handler:function(){this.listQuery.task_id=this.$route.query.id,this.handleFilter()}}}},v=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{ref:"headerBox",staticClass:"header-box"},[a("el-form",{ref:"listQuery",staticClass:"advt-form-inline",attrs:{inline:!0,model:t.listQuery,size:"mini"}},[a("el-form-item",{attrs:{label:"任务ID",prop:"task_id"}},[a("el-input",{attrs:{size:"mini",clearable:"",placeholder:"请输入任务ID"},model:{value:t.listQuery.task_id,callback:function(e){t.$set(t.listQuery,"task_id","string"===typeof e?e.trim():e)},expression:"listQuery.task_id"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"状态",prop:"status"}},[a("el-select",{attrs:{size:"mini",clearable:"",placeholder:"请选择"},model:{value:t.listQuery.status,callback:function(e){t.$set(t.listQuery,"status","string"===typeof e?e.trim():e)},expression:"listQuery.status"}},t._l(t.statusList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{"data-type":"search",type:"primary"},on:{click:t.handleFilter}},[t._v("搜索")]),t._v(" "),a("el-button",{attrs:{"data-type":"clear"},on:{click:t.clearSearch}},[t._v("清空")])],1)],1),t._v(" "),a("el-row",{staticClass:"right-row"},[a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:t.clearLogs}},[t._v("清空日志")])],1)],1),t._v(" "),a("div",{staticClass:"content-box"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading.lock",value:t.listLoading,expression:"listLoading",modifiers:{lock:!0}}],key:t.newDate,ref:"table",staticStyle:{width:"100%"},attrs:{data:t.listData,"default-expand-all":t.expand,"element-loading-text":"努力加载中",border:""},on:{"header-click":t.handleExpand}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{attrs:{"label-position":"left"}},[a("el-form-item",[t._v("\n              重试次数: "+t._s(e.row.retry_times)+" "),a("br"),t._v("\n              cron表达式: "+t._s(e.row.spec)+" "),a("br"),t._v("\n              命令: "+t._s(e.row.command)+"\n            ")])],1)]}}])},[a("template",{slot:"header"},[a("svg-icon",{attrs:{"icon-class":"right"}})],1)],2),t._v(" "),a("el-table-column",{attrs:{prop:"id",label:"ID"}}),t._v(" "),a("el-table-column",{attrs:{prop:"task_id",label:"任务ID"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"任务名称",width:"300"}}),t._v(" "),a("el-table-column",{attrs:{label:"任务节点",width:"300"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{domProps:{innerHTML:t._s(e.row.hostname)}},[t._v(t._s(e.row.hostname))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"执行时长",width:"300"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          执行时长: "+t._s(e.row.total_time>0?e.row.total_time:1)+"秒"),a("br"),t._v("\n          开始时间: "+t._s(t._f("formatTime")(e.row.start_time))),a("br"),t._v(" "),1!==e.row.status?a("span",[t._v("结束时间: "+t._s(t._f("formatTime")(e.row.end_time)))]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[0===e.row.status?a("span",{staticStyle:{color:"red"}},[t._v("失败")]):1===e.row.status?a("span",{staticStyle:{color:"green"}},[t._v("执行中")]):2===e.row.status?a("span",[t._v("成功")]):3===e.row.status?a("span",{staticStyle:{color:"#4499EE"}},[t._v("取消")]):t._e()]}}])}),t._v(" "),this.isAdmin?a("el-table-column",{attrs:{label:"执行结果"},scopedSlots:t._u([{key:"default",fn:function(e){return[2===e.row.status?a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(a){return t.showTaskResult(e.row)}}},[t._v("\n            查看结果\n          ")]):t._e(),t._v(" "),0===e.row.status?a("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(a){return t.showTaskResult(e.row)}}},[t._v("\n            查看结果\n          ")]):t._e(),t._v(" "),1===e.row.status&&2===e.row.protocol?a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return t.handleStopTask(e.row)}}},[t._v("\n            停止任务\n          ")]):t._e()]}}],null,!1,1201835113)}):a("el-table-column",{attrs:{label:"执行结果"},scopedSlots:t._u([{key:"default",fn:function(e){return[2===e.row.status?a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(a){return t.showTaskResult(e.row)}}},[t._v("\n            查看结果\n          ")]):t._e(),t._v(" "),0===e.row.status?a("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(a){return t.showTaskResult(e.row)}}},[t._v("\n            查看结果\n          ")]):t._e()]}}])})],1),t._v(" "),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper",small:"","current-page":t.listQuery.page,"page-sizes":[20,50,100,200],"page-size":t.listQuery.page_size,total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),t._v(" "),a("task-log-detail",t._b({},"task-log-detail",t.logsDetailOption,!1,!0))],1)},_=[];function g(t){a("046e")}var k=!1,y=g,w="data-v-59653cf2",x=null,L=Object(l["a"])(b,v,_,k,y,w,x);e["default"]=L.exports},"163b":function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));a("7f7f"),a("ac6a");var n=a("2b0e"),r=function(t){return n["default"]._.mapValues(t,(function(t){return t||void 0}))}},"421d":function(t,e,a){e=t.exports=a("2350")(!1),e.push([t.i,".el-table th>.cell>svg[data-v-59653cf2]{color:#fff;-webkit-transition:.5s linear;transition:.5s linear;cursor:pointer}",""])},b199:function(t,e,a){"use strict";a.d(e,"h",(function(){return r})),a.d(e,"f",(function(){return o})),a.d(e,"i",(function(){return s})),a.d(e,"e",(function(){return i})),a.d(e,"c",(function(){return l})),a.d(e,"j",(function(){return u})),a.d(e,"b",(function(){return c})),a.d(e,"g",(function(){return d})),a.d(e,"d",(function(){return f})),a.d(e,"a",(function(){return p})),a.d(e,"k",(function(){return m}));var n=a("b775");function r(){return Object(n["a"])({url:"/project/all",method:"get"})}function o(){return Object(n["a"])({url:"/host/all",method:"get"})}function s(t){return Object(n["a"])({url:"/task",method:"get",params:t})}function i(t,e){return Object(n["a"])({url:"/task/enable/".concat(e),method:"post",data:t})}function l(t,e){return Object(n["a"])({url:"/task/disable/".concat(e),method:"post",data:t})}function u(t){return Object(n["a"])({url:"/task/run/".concat(t),method:"get"})}function c(t){return Object(n["a"])({url:"/task/remove/".concat(t),method:"post"})}function d(t){return Object(n["a"])({url:"task/log",method:"get",params:t})}function f(t){return Object(n["a"])({url:"/task/store",method:"post",data:t})}function p(){return Object(n["a"])({url:"/task/log/clear",method:"post"})}function m(t){return Object(n["a"])({url:"/task/log/stop",method:"post",data:t})}},b46a:function(t,e,a){var n=a("b5ee");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var r=a("2fb2").default;r("7da8298a",n,!0,{})},b5ee:function(t,e,a){e=t.exports=a("2350")(!1),e.push([t.i,"",""])}}]);