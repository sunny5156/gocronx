{"remainingRequest":"/root/go/src/github.com/sunny5156/gocronx/web/new-theme/node_modules/thread-loader/dist/cjs.js!/root/go/src/github.com/sunny5156/gocronx/web/new-theme/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js!/root/go/src/github.com/sunny5156/gocronx/web/new-theme/node_modules/@vue/cli-plugin-eslint/node_modules/eslint-loader/index.js??ref--13-0!/root/go/src/github.com/sunny5156/gocronx/web/new-theme/src/store/modules/user.js","dependencies":[{"path":"/root/go/src/github.com/sunny5156/gocronx/web/new-theme/src/store/modules/user.js","mtime":1600073058000},{"path":"/root/go/src/github.com/sunny5156/gocronx/web/new-theme/node_modules/cache-loader/dist/cjs.js","mtime":1600257155902},{"path":"/root/go/src/github.com/sunny5156/gocronx/web/new-theme/node_modules/thread-loader/dist/cjs.js","mtime":1600257158773},{"path":"/root/go/src/github.com/sunny5156/gocronx/web/new-theme/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js","mtime":1600257116664},{"path":"/root/go/src/github.com/sunny5156/gocronx/web/new-theme/node_modules/@vue/cli-plugin-eslint/node_modules/eslint-loader/index.js","mtime":1600257145698}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport { login, logout, getInfo } from '@/api/login';\nimport { getToken, setToken, removeToken } from '@/utils/auth';\nimport { resetRouter } from '@/router';\nvar user = {\n  namespaced: true,\n  state: {\n    token: getToken(),\n    name: '',\n    avatar: '',\n    permissions: [],\n    info: null,\n    isAdmin: false\n  },\n  mutations: {\n    SET_TOKEN: function SET_TOKEN(state, token) {\n      state.token = token;\n    },\n    SET_NAME: function SET_NAME(state, name) {\n      state.name = name;\n    },\n    SET_AVATAR: function SET_AVATAR(state, avatar) {\n      state.avatar = avatar;\n    },\n    SET_PERMISSIONS: function SET_PERMISSIONS(state, permissions) {\n      state.permissions = permissions;\n    },\n    SET_INFO: function SET_INFO(state, info) {\n      state.info = info;\n    },\n    SET_ADMIN: function SET_ADMIN(state, isAdmin) {\n      state.isAdmin = isAdmin;\n    }\n  },\n  actions: {\n    // 登录\n    Login: function Login(_ref, userInfo) {\n      var commit = _ref.commit,\n          state = _ref.state;\n      var username = userInfo.username.trim();\n      return new Promise(function (resolve, reject) {\n        login(username, userInfo.password).then(function (response) {\n          setToken(response.data.token);\n          localStorage.setItem('userInfo', JSON.stringify(response.data));\n          commit('SET_TOKEN', response.data.token);\n          commit('SET_NAME', response.data.account);\n          commit('SET_ADMIN', response.data.is_admin);\n          commit('SET_INFO', response.data);\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 获取用户信息\n    GetInfo: function GetInfo(_ref2) {\n      var commit = _ref2.commit,\n          state = _ref2.state;\n      return new Promise(function (resolve, reject) {\n        getInfo(state.token).then(function (response) {\n          var data = response.data;\n\n          if (!data) {\n            reject('Verification failed, please Login again.');\n          } // data.permissions.forEach(v => {\n          //   v.enable = true\n          // })\n\n\n          if (data.permissions && data.permissions.length > 0) {\n            // 验证返回的permissions是否是一个非空数组\n            commit('SET_PERMISSIONS', data.permissions);\n          } else {\n            reject('getInfo: permissions must be a non-null array !');\n          }\n\n          var info = data.info;\n          commit('SET_NAME', info.name);\n          commit('SET_INFO', info);\n          resolve(data);\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 登出\n    LogOut: function LogOut(_ref3) {\n      var commit = _ref3.commit,\n          state = _ref3.state;\n      return new Promise(function (resolve, reject) {\n        commit('SET_TOKEN', '');\n        commit('SET_NAME', '');\n        commit('SET_ADMIN', false);\n        commit('SET_INFO', {});\n        localStorage.setItem('userInfo', '{}');\n        removeToken();\n        resetRouter();\n        resolve();\n      });\n    },\n    // 前端 登出\n    FedLogOut: function FedLogOut(_ref4) {\n      var commit = _ref4.commit;\n      return new Promise(function (resolve) {\n        commit('SET_TOKEN', '');\n        removeToken();\n        resolve();\n      });\n    }\n  }\n};\nexport default user;",null]}